---
title: 'Phase-Based Trajectory Optimization for Legged Locomotion'
date: '2025-12-11'
tags: ['Legged Locomotion', 'Trajectory Optimization', 'CasADi', 'MATLAB', 'MuJoCo', 'NLP']
draft: false
summary: >-
  Replicated a phase-based trajectory optimization framework (TOWR) for a bipedal robot. Utilized CasADi, MATLAB, and MuJoCo to generate optimal walking gaits, centroidal trajectories, and contact sequences without discrete variables.
---

## Project Overview

### The Challenge

Legged locomotion presents a long standing challenge due to the tight coupling between contact forces, body dynamics, kinematics constraints, gait timing, and foothold placement. Simplified methods (like the Linear Inverted Pendulum model) often require predefined gait sequences and foothold locations. This approach restricts adaptability and limits highly dynamic motions over uneven terrain. The development of full rigid-body and centroidal models allows for more complex motion, but is frequently computationally expensive and may still require predefined contact timings.

### The Task

Drawing inspiration from Winkler et al.'s phase-based end-effector parameterization, my team and I replicated their unified Nonlinear Program (NLP) using **CasADi** and visualized results in **MuJoCo**. We modeled the gait using a continuous phase-based parameterization for each foot. This allows the optimizer to smoothly adjust step timings to discover feasible gait patterns.

---

## Technical Contributions

### 1. Continuous Phase-Based Parameterization

To avoid discrete contact decisions, we parameterized the duration of the swing and stance phases for each leg using continuous variables.

- **Foot Polynomials:** The position and force of each foot were segmented into 3rd-order Hermite polynomials. If a segment fell within a stance phase, we constrained the foot velocity to zero and enforced non-negative force. In a swing phase, forces were constrained to zero and position was bounded above the terrain.
- **Centroid Splines:** The body's Center of Mass (CoM) trajectory was represented by a series of 4th-order polynomials. We enforced $C^2$ continuity between segments to guarantee smooth velocity and acceleration profiles across the entire motion.

### 2. Centroidal Dynamics & Contact Constraints

We enforced rigid-body dynamics and kinematic limits at equal intervals across the trajectory to ensure physical feasibility.

- **Dynamics Enforcement:** We constrained the CoM motion to strictly obey the combined contact forces and torques generated by the feet.
- **Unilateral Forces & Friction:** To generate physically correct walking behavior, legs can only push against the ground, never pull. We enforced this unilateral constraint alongside a linearized friction pyramid approximation to keep the optimization problem tractable.

### 3. Performance Analysis

We evaluated the NLP on a 5-bar link planar bipedal robot model ("Rabbit") walking on an even surface.

- **Gait Generation:** The optimizer successfully generated a coherent 4-step forward walking motion, demonstrating sensible vertical CoM oscillation and smooth stance-swing force activation (load transfer) between the two legs.
- **MuJoCo Validation:** We constructed a pipeline to pass the generated motion to a whole-body controller for validation in **MuJoCo**. While simple motions (like a single leg swing) successfully played back in simulation, complex full-body motions revealted the dynamic mismatches between our simplified NLP planner model and the rigid-body constraints of the MuJoCo environment.

### 4. Results & Reflections

While our implementation successfully validated the core mechanics (phase-structured splines, friction cones, and centroidal dynamics) we ultimately utilized a fixed contact schedule to achieve convergence for the full walking gait. Consequently, we did not fully replicate TOWR's flagship capability of completely autonomous, end-to-end gait discovery. Furthermore, we encountered critical difficulties translating these complex trajectories into MuJoCo.

Despite these hurdles, building this architecture from the ground up was an incredibly instructive exercise. It solidified my practical understanding of **Nonlinear Programming (NLP) formulation**, **direct collocation techniques** , and the mathematical rigor required to translate discrete contact events into continuous optimization problems. I look forward to revisiting this framework in the future to refine the constraints and unlock fully emergent dynamic gaits.

{/* Image Gallery - Side by Side Horizontal Photos */}

<div className="-mx-2 my-8 flex flex-wrap items-start">

{/* Image 1 */}

<div className="mb-4 w-full px-2 md:mb-0 md:w-1/2">
  <img
    src="/static/images/4steps_pos.png"
    alt="CoM and Foot 4-Step Trajectory Visualization"
    className="h-auto w-full object-contain shadow-md"
  />
  <div className="mt-2 text-center text-sm text-gray-500 italic">
    Figure 1: Generated Center of Mass and foot trajectories over a 4-step walking gait. Both feet
    start in stance, then alternate stance/swing phases.
  </div>
</div>

{/* Image 2 */}

<div className="w-full px-2 md:w-1/2">
  <img
    src="/static/images/4steps_force.png"
    alt="Contact Force vs Time Plot"
    className="h-auto w-full object-contain shadow-md"
  />
  <div className="mt-2 text-center text-sm text-gray-500 italic">
    Figure 2: Stance-swing load transfer visualization showing alternating foot contact forces.
  </div>
</div>

</div>

{/* Video Embed - Centered Below Images */}

<div className="my-8 w-full">
  <a
    href="https://www.youtube.com/watch?v=sex71kgeQSc"
    target="_blank"
    rel="noopener noreferrer"
    className="group relative block w-full overflow-hidden rounded-lg shadow-lg"
  >
    {/* Thumbnail Image */}
    <img
      src="https://img.youtube.com/vi/sex71kgeQSc/maxresdefault.jpg"
      alt="Click to watch MuJoCo simulation playback"
      className="w-full object-cover group-hover:opacity-90 transition-opacity duration-300"
    />

    {/* 2. The Play Button Overlay */}
    <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
      <div className="bg-white/90 rounded-full p-4 shadow-xl group-hover:scale-110 transition-transform duration-300">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          className="h-8 w-8 text-red-600 fill-current ml-1"
          viewBox="0 0 24 24"
        >
          <path d="M8 5v14l11-7z" />
        </svg>
      </div>
    </div>

  </a>
  <div className="mt-2 text-center text-sm text-gray-500 italic">
    MuJoCo playback of the optimized bipedal trajectory for one step. (Click to watch)
  </div>
</div>
